<!DOCTYPE HTML>
<html lang="en">
<HEAD>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial scale = 1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Твой маршрут </title>
</HEAD>
<style>
    body{
        background-image: url('/images/login/bg-01.jpg');
        background-size: 100% 100%;
        background-repeat: no-repeat;
    }

    .centered{
        margin-left: 150px;
        font-family : "Times New Roman", Times, serif;
    }

    #map {
        height: 400px;
        width: 800px;
        margin-left: 150px;
        border-radius: 12px;
    }

    #addressCityStart {
        width: 350px;
        height: 20px;
        margin-left: 150px;
        border-radius: 12px;
        padding-left: 10px;
    }

    #addressStreetEnd {
        width: 350px;
        height: 20px;
        margin-left: 90px;
        border-radius: 12px;
        padding-left: 10px;
    }

    #addressStreetStart {
        width: 350px;
        height: 20px;
        margin-left: 150px;
        border-radius: 12px;
        padding-left: 10px;
    }

    #addressCityEnd {
        width: 350px;
        height: 20px;
        margin-left: 90px;
        border-radius: 12px;
        padding-left: 10px;

    }

    #addressStreetNumberEnd {
        width: 250px;
        height: 20px;
        margin-left: 190px;
        border-radius: 12px;
        padding-left: 10px;
    }

    #addressStreetNumberStart {
        width: 250px;
        height: 20px;
        margin-left: 150px;
        border-radius: 12px;
        padding-left: 10px;
    }

    #buttonConfirmRoute {
        width: 150px;
        display: block;
        height: 30px;
        margin-left: 150px;
        border-radius: 12px;
        box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
    }

    #buttonRoute {
        width: 150px;
        height: 30px;
        margin-left: 150px;
        border-radius: 12px;
        box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);

    }
    pre.tab{
        font-family: "Times New Roman";
        font-size: large;
        margin-left: 160px;
    }
    pre.way{
        font-family: "Times New Roman";
        font-size: large;
        margin-left: 160px;
    }
    .buttonRoute {
        background: #a64bf4;
        background: -webkit-linear-gradient(right, #fc00ff, #9F51F3, #fc00ff, #9F51F3);
        background: -o-linear-gradient(right, #fc00ff, #9F51F3, #fc00ff, #9F51F3);
        background: -moz-linear-gradient(right, #fc00ff, #9F51F3, #fc00ff, #9F51F3);
        background: linear-gradient(right, #fc00ff, #9F51F3, #fc00ff, #9F51F3);
        border: 1px outset black ;
        border-radius: 2px
    }


    .buttonConfirmRoute {
        background: #a64bf4;
        background: -webkit-linear-gradient(right, #fc00ff, #9F51F3, #fc00ff, #9F51F3);
        background: -o-linear-gradient(right, #fc00ff, #9F51F3, #fc00ff, #9F51F3);
        background: -moz-linear-gradient(right, #fc00ff, #9F51F3, #fc00ff, #9F51F3);
        background: linear-gradient(right, #fc00ff, #9F51F3, #fc00ff, #9F51F3);
        border: 1px outset black;
        border-radius: 2px
    }

    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        padding-top: 100px; /* Location of the box */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0, 0, 0); /* Fallback color */
        background-color: rgba(0, 0, 0, 0.4); /* Black w/ opacity */
    }

    .modal-content {
        background-color: #fefefe;
        margin: auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
    }

    .modal2 {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        padding-top: 100px; /* Location of the box */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0, 0, 0); /* Fallback color */
        background-color: rgba(0, 0, 0, 0.4); /* Black w/ opacity */
    }

    .modal-content2 {
        background-color: #fefefe;
        margin: auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
    }

    /* The Close Button */
    .close {
        color: #aaaaaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
    }

    .close2 {
        color: #aaaaaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close2:hover,
    .close2:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
    }
</style>
<body>
<div class="centered">
    <h1>Построй марушрут</h1>
</div>
<div id="myModalType" class="modal2">
    <div class="modal-content2">
        <span class="close2">&times;</span>
        <p>Введенные данные содержат ошибки, недействительны, либо необходимые поля не заполнены. Проверьте их.</p>
    </div>
</div>
<div id="myModalEmpty" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <p>Ошибка! Создайте свой маршрут перед продолжением.</p>
    </div>

</div>

<div id="map"></div>
<div id="right-panel"></div>
<pre class="way">Дистанция маршрута:<span id="total"></span></pre>
<pre class="tab">Начало пути:                                                                              Конец пути:</pre>
<form id="form">
    <input id="addressCityStart" name="addressCityStart" type="textbox" placeholder="Введите город (обязательное поле)"
           required/>
    <input id="addressCityEnd" name="addressCityEnd" type="textbox" placeholder="Введите город (обязательное поле)"
           required/><hr style="height:2px; visibility:hidden;" />
    <input id="addressStreetStart" type="textbox" placeholder="Введите улицу (необязательное поле)"/>
    <input id="addressStreetEnd" type="textbox" placeholder="Введите улицу (необязательное поле)"/><hr style="height:2px; visibility:hidden;" />
    <input id="addressStreetNumberStart" type="textbox" placeholder="Номер дома (необязательное поле)"/>
    <input id="addressStreetNumberEnd" type="textbox" placeholder="Номер дома (необязательное поле)"/><hr style="height:2px; visibility:hidden;" />
    <input id="buttonRoute" type="button" class="buttonRoute"  value="Построить маршрут"/><hr style="height:2px; visibility:hidden;" />
    <input id="buttonConfirmRoute" type="button" class="buttonConfirmRoute" value="Подтвердить маршрут"/>

</form>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<script>

    var map;
    var geocoder;
    var citystart;
    var cityend;
    var streetstart;
    var streetend ;
    var streetstartnumber ;
    var streetendnumber ;

    function redirectToNext() {

        if (counter){
            axios({
                method: 'post',
                url: '/create-route',
                data: {
                    startCity: citystart,
                    endCity: cityend,
                    startStreet: streetstart,
                    endStreet: streetend,
                    startStreetNumber: streetstartnumber,
                    endStreetNumber: streetendnumber
                }
            }).then(response => {
                localStorage.setItem("route", JSON.stringify(response.data));
                window.location.replace('create-trip');
            });

        }else{
            modalEmptyFields.style.display = "block"
        }
    }

    function initMap() {
        var directionsService = new google.maps.DirectionsService();
        var directionsRenderer = new google.maps.DirectionsRenderer();
        panel: document.getElementById('right-panel');
        geocoder = new google.maps.Geocoder();
        var options = {
            zoom: 15,
            center: {lat: 55.752571, lng: 48.744153},
            styles: [
                {elementType: 'geometry', stylers: [{color: '#242f3e'}]},
                {elementType: 'labels.text.stroke', stylers: [{color: '#242f3e'}]},
                {elementType: 'labels.text.fill', stylers: [{color: '#746855'}]},
                {
                    featureType: 'administrative.locality',
                    elementType: 'labels.text.fill',
                    stylers: [{color: '#d59563'}]
                },
                {
                    featureType: 'poi',
                    elementType: 'labels.text.fill',
                    stylers: [{color: '#d59563'}]
                },
                {
                    featureType: 'poi.park',
                    elementType: 'geometry',
                    stylers: [{color: '#263c3f'}]
                },
                {
                    featureType: 'poi.park',
                    elementType: 'labels.text.fill',
                    stylers: [{color: '#6b9a76'}]
                },
                {
                    featureType: 'road',
                    elementType: 'geometry',
                    stylers: [{color: '#38414e'}]
                },
                {
                    featureType: 'road',
                    elementType: 'geometry.stroke',
                    stylers: [{color: '#212a37'}]
                },
                {
                    featureType: 'road',
                    elementType: 'labels.text.fill',
                    stylers: [{color: '#9ca5b3'}]
                },
                {
                    featureType: 'road.highway',
                    elementType: 'geometry',
                    stylers: [{color: '#746855'}]
                },
                {
                    featureType: 'road.highway',
                    elementType: 'geometry.stroke',
                    stylers: [{color: '#1f2835'}]
                },
                {
                    featureType: 'road.highway',
                    elementType: 'labels.text.fill',
                    stylers: [{color: '#f3d19c'}]
                },
                {
                    featureType: 'transit',
                    elementType: 'geometry',
                    stylers: [{color: '#2f3948'}]
                },
                {
                    featureType: 'transit.station',
                    elementType: 'labels.text.fill',
                    stylers: [{color: '#d59563'}]
                },
                {
                    featureType: 'water',
                    elementType: 'geometry',
                    stylers: [{color: '#17263c'}]
                },
                {
                    featureType: 'water',
                    elementType: 'labels.text.fill',
                    stylers: [{color: '#515c6d'}]
                },
                {
                    featureType: 'water',
                    elementType: 'labels.text.stroke',
                    stylers: [{color: '#17263c'}]
                }
            ]
        };
        map = new google.maps.Map(document.getElementById("map"), options);
        directionsRenderer.setMap(map);
        document.getElementById('buttonRoute').addEventListener('click', function () {
            calculateAndDisplayRoute(directionsService, directionsRenderer);

        });
        document.getElementById('buttonConfirmRoute').addEventListener('click', function () {
            redirectToNext();
        });
    }

    var modalInvalidType = document.getElementById("myModalType");
    var modalEmptyFields = document.getElementById("myModalEmpty");


    var span = document.getElementsByClassName("close")[0];
    var span2 = document.getElementsByClassName("close2")[0];

    var counter = false;

    span.onclick = function () {
        modalEmptyFields.style.display = "none";
    };

    window.onclick = function (event) {
        if (event.target === modalEmptyFields) {
            modalEmptyFields.style.display = "none";
        }
    };

    span2.onclick = function () {
        modalInvalidType.style.display = "none";
    };

    window.onclick = function (event) {
        if (event.target === modalInvalidType) {
            modalInvalidType.style.display = "none";
        }
    };

    function calculateAndDisplayRoute(directionsService, directionsRenderer) {
        panel: document.getElementById('right-panel');
        citystart= document.getElementById('addressCityStart').value;
        cityend = document.getElementById('addressCityEnd').value;
        streetstart = document.getElementById('addressStreetStart').value;
        streetend = document.getElementById('addressStreetEnd').value;
        streetstartnumber = document.getElementById('addressStreetNumberStart').value;
        streetendnumber = document.getElementById('addressStreetNumberEnd').value;
        if (!isNaN(cityend) || !isNaN(citystart) || (streetend !=='' && !isNaN(streetend)) || (streetstart !=='' && !isNaN(streetstart)) || isNaN(streetstartnumber) || isNaN(streetendnumber)) {
            modalInvalidType.style.display = "block";
            return false;
        }

        if ((cityend || cityend !== '') && (citystart || citystart !== '')) {
            var start = citystart + '' + streetstart + '' + streetstartnumber;
            var end = cityend + '' + streetend + '' + streetendnumber;
            localStorage.setItem("StarLoc",start);
            localStorage.setItem("EndLoc", end);
            var request = {
                origin: start,
                destination: end,
                travelMode: 'DRIVING'
            };
        } else {
            return;
        }
        directionsService.route(request, function (result, status) {
            if (status === 'OK') {
                directionsRenderer.setDirections(result);
                counter=true;
            } else {
                modalInvalidType.style.display = "block";
            }
            var total = 0;
            var myroute = result.routes[0];
            for (var i = 0; i < myroute.legs.length; i++) {
                total += myroute.legs[i].distance.value;
            }
            total = total / 1000;
            document.getElementById('total').innerHTML = total + ' км';
        });
    }



</script>

<script
        async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBtzvGgZp_TyiIsUWDNqI-lQuajA_xCj3A&callback=initMap"></script>
</body>
<html>